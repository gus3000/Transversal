#include <iostream>
#include <string>

//#include "opencv2/core/core.hpp"
#include "opencv2/opencv.hpp"

using std::cout;
using std::cerr;
using std::endl;
using std::string;
using std::stoi;

using cv::VideoCapture;
using cv::Mat;
using cv::waitKey;

void printUsage(string exename)
{
  cout << "Usage : " << exename << " mediafile [fps]" << endl;
}

int main(int argc, char *argv[])
{
  if(argc == 1)
    {
      cout << "You must give a readable file name in argument." << endl;
      printUsage(argv[0]);
      return 0;
    }

  string fileName = argv[1];
  int fps = 30; //default value
  VideoCapture video(fileName);
  if(!video.isOpened())
    {
      cerr << "Error : Cannot open video file. Exiting..." << endl;
      return -1;
    }

  fps = (int) video.get(CV_CAP_PROP_FPS);
  int toWait = 1000/fps;
  float nbFrames = video.get(CV_CAP_PROP_FRAME_COUNT);
  for(int i=0; i<nbFrames; ++i)
  {
      Mat frame;
      video >> frame;
      imshow("frame",frame);
      waitKey(toWait);
    }
  
  return 0;
}
